name: Delete Azure Resources to Reduce Billing in Trial Account

on:
  schedule:
    - cron: 0 19 * * *
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (0 - 59)
# â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (0 - 23)
# â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of the month (1 - 31)
# â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ month (1 - 12 or JAN-DEC)
# â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of the week (0 - 6 or SUN-SAT)
# â”‚ â”‚ â”‚ â”‚ â”‚
# * * * * *
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  delete-resources:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout branch ${{ github.ref_name }}
      uses: actions/checkout@v6.0.2
      
    - name: Azure Login
      uses: Azure/login@v2.3.0
      with:
        client-id: 5ce3ab7b-0446-4eed-aa43-166a841569c9
        tenant-id: f0641df5-399b-4110-b104-73965dc34f37
        subscription-id: 5eb4a75d-ca9f-4447-9fba-c48dba45e976

    - name: Check Current Azure Account
      uses: Azure/cli@v2.2.0
      with:
        # Specify the script here
        inlineScript: |
          az account show
          
    - name: Delete Azure Resource Groups
      uses: Azure/cli@v2.2.0
      with:
        # Specify the script here
        inlineScript: |
          # LOCK_IDS=$(az lock list \
          # --resource-group "$RG_NAME" \
          # --query "[].id" \
          # -o tsv)

          # if [[ -z "$LOCK_IDS" ]]; then
          #   echo "âœ… No locks found."
          # else
          #   echo "ðŸ§¹ Removing locks..."
          #   while read -r LOCK_ID; do
          #     echo "Deleting lock: $LOCK_ID"
          #     az lock delete --ids "$LOCK_ID"
          #   done <<< "$LOCK_IDS"
          # fi
          
          for rg in $(az group list --query "[].name" -o tsv); do
            echo "Deleting resource group: $rg"
            az group delete --name "$rg" --yes --no-wait
          done
    
        
   
  
